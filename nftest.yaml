---
global:
  temp_dir: ./test/work
  nf_config: test/global.config
  remove_temp: false
  clean_logs: true

cases:
  - name: test-bam2fastq
    message: Test convert-BAM2FASTQ
    nf_script: test/test-bam2fastq/test.nf
    nf_config: test/test-bam2fastq/test.config
    verbose: true
    skip: true
    asserts:
      - actual: output/convert-BAM2FASTQ-2.0.0-rc.1/TCEB1_RCC_S00-9422N_079_114/SAMtools-1.15.1/output/S00-9422N_079_114.Seq1_collated_R1.fq.gz
        expect: /hot/software/pipeline/metapipeline-DNA/Nextflow/development/meta-germline-somatic/systematic_tests/bam2fastq/output/TCEB1/TCEB1_RCC_S00-9422N_079_114/collated_S00-9422N_079_114.Seq1_R1.fq.gz
        script: test/test-bam2fastq/assert_fastq.sh

      - actual: output/convert-BAM2FASTQ-2.0.0-rc.1/TCEB1_RCC_S00-9422N_079_114/SAMtools-1.15.1/output/S00-9422N_079_114.Seq1_collated_R2.fq.gz
        expect: /hot/software/pipeline/metapipeline-DNA/Nextflow/development/meta-germline-somatic/systematic_tests/bam2fastq/output/TCEB1/TCEB1_RCC_S00-9422N_079_114/collated_S00-9422N_079_114.Seq1_R2.fq.gz
        script: test/test-bam2fastq/assert_fastq.sh

      - actual: intermediate/convert_BAM2FASTQ/create_CSV_align_DNA-TCEB1/TCEB1_RCC_S00-9422N_079_114/align_DNA_input.csv
        expect: /hot/software/pipeline/metapipeline-DNA/Nextflow/development/meta-germline-somatic/systematic_tests/bam2fastq/output/TCEB1/align_DNA_input.csv
        script: test/test-bam2fastq/assert_input_csv.py


  - name: test-align-DNA
    message: Test align-DNA
    nf_script: test/test-align-DNA/test.nf
    nf_config: test/test-align-DNA/test.config
    verbose: true
    skip: true
    # Disabling BAM comparisons since there can be variability based on number of threads used
    # asserts:
    # - actual: output/align-DNA-9.0.0/TCEB1-RCC-S00-9422N-079-114/BWA-MEM2-2.2.1/output/BWA-MEM2-2.2.1_TCEB1_TCEB1-RCC-S00-9422N-079-114.bam
    #   expect: /hot/software/pipeline/metapipeline-DNA/Nextflow/development/meta-germline-somatic/systematic_tests/align-DNA/TCEB1/TCEB1_RCC_S00-9422N_079_114/TCEB1_RCC_S00-9422N_079_114.bam
    #   method: md5

    # - actual: output/align-DNA-9.0.0/TCEB1-RCC-S00-9422T-027-166/BWA-MEM2-2.2.1/output/BWA-MEM2-2.2.1_TCEB1_TCEB1-RCC-S00-9422T-027-166.bam
    #   expect: /hot/software/pipeline/metapipeline-DNA/Nextflow/development/meta-germline-somatic/systematic_tests/align-DNA/TCEB1/TCEB1_RCC_S00-9422T_027_166/TCEB1_RCC_S00-9422T_027_166.bam
    #   method: md5

  - name: test-recalibrate-BAM
    message: Test recalibrate-BAM
    nf_script: test/test-recalibrate-BAM/test.nf
    nf_config: test/test-recalibrate-BAM/test.config
    verbose: true
    skip: true

  - name: test-call-gSNP
    message: Test call-gSNP with one tumor normal pair
    nf_script: test/test-call-gSNP/test.nf
    nf_config: test/test-call-gSNP/test.config
    verbose: true
    skip: true
    asserts:
      - actual: output/call-gSNP-10.0.0-rc.1/9422/GATK-4.2.4.1/output/GATK-4.2.4.1_test_S00-9422T-027-166.g.vcf.gz
        expect: /hot/software/pipeline/metapipeline-DNA/Nextflow/development/meta-germline-somatic/systematic_tests/call-gSNP/output/test-call-gSNP/TCEB1/S00-9422T_027_166_merged_raw_variants.g.vcf.gz
        script: test/test-call-gSNP/assert_vcf.sh

  #   Disabling BAM comparison for now - checksums differ even if tools like GATK CompareSAMs report identical BAM files
  #   requires a custom script to use GATK docker for comparison of BAMs
  # - actual: test/output/output/call-gSNP-8.0.0/TCEB1_RCC_S00/GATK-4.2.4.1/output/S00-9422N_079_114_realigned_recalibrated_merged.bam
  #   expect: /hot/software/pipeline/metapipeline-DNA/Nextflow/development/meta-germline-somatic/systematic_tests/call-gSNP/output/test-call-gSNP/TCEB1/S00-9422N_079_114_realigned_recalibrated_merged.bam


  - name: test-call-sSNV
    message: Test call-sSNV with one tumor normal pair
    nf_script: test/test-call-sSNV/test.nf
    nf_config: test/test-call-sSNV/test.config
    verbose: true
    skip: true
    asserts:
      - actual: output/call-sSNV-7.0.0-rc.1/GZLUCPTA000001-T001-P01-F/Intersect-BCFtools-1.17/output/BCFtools-1.17_LUAD0000034_GZLUCPTA000001-T001-P01-F_SNV-concat.vcf.gz
        expect: /hot/software/pipeline/metapipeline-DNA/Nextflow/development/germline-somatic/1.0.0/test-output/test-call-sSNV/GZLUCPTA000001/GZLUCPTA000001-T001-P01-F/call_sSNV/BCFtools-1.17_LUAD0000034_GZLUCPTA000001-T001-P01-F_SNV-concat.vcf.gz
        script: test/test-call-gSNP/assert_vcf.sh
      - actual: output/call-sSNV-7.0.0-rc.1/GZLUCPTA000001-T001-P01-F/Intersect-BCFtools-1.17/output/MuSE-2.0.2_LUAD0000034_GZLUCPTA000001-T001-P01-F_SNV-intersect.vcf.gz
        expect: /hot/software/pipeline/metapipeline-DNA/Nextflow/development/germline-somatic/1.0.0/test-output/test-call-sSNV/GZLUCPTA000001/GZLUCPTA000001-T001-P01-F/call_sSNV/MuSE-2.0.2_LUAD0000034_GZLUCPTA000001-T001-P01-F_SNV-intersect.vcf.gz
        script: test/test-call-gSNP/assert_vcf.sh
      - actual: output/call-sSNV-7.0.0-rc.1/GZLUCPTA000001-T001-P01-F/Intersect-BCFtools-1.17/output/Mutect2-4.4.0.0_LUAD0000034_GZLUCPTA000001-T001-P01-F_SNV-intersect.vcf.gz
        expect: /hot/software/pipeline/metapipeline-DNA/Nextflow/development/germline-somatic/1.0.0/test-output/test-call-sSNV/GZLUCPTA000001/GZLUCPTA000001-T001-P01-F/call_sSNV/Mutect2-4.4.0.0_LUAD0000034_GZLUCPTA000001-T001-P01-F_SNV-intersect.vcf.gz
        script: test/test-call-gSNP/assert_vcf.sh
      - actual: output/call-sSNV-7.0.0-rc.1/GZLUCPTA000001-T001-P01-F/Intersect-BCFtools-1.17/output/SomaticSniper-1.0.5.0_LUAD0000034_GZLUCPTA000001-T001-P01-F_SNV-intersect.vcf.gz
        expect: /hot/software/pipeline/metapipeline-DNA/Nextflow/development/germline-somatic/1.0.0/test-output/test-call-sSNV/GZLUCPTA000001/GZLUCPTA000001-T001-P01-F/call_sSNV/SomaticSniper-1.0.5.0_LUAD0000034_GZLUCPTA000001-T001-P01-F_SNV-intersect.vcf.gz
        script: test/test-call-gSNP/assert_vcf.sh
      - actual: output/call-sSNV-7.0.0-rc.1/GZLUCPTA000001-T001-P01-F/Intersect-BCFtools-1.17/output/Strelka2-2.9.10_LUAD0000034_GZLUCPTA000001-T001-P01-F_SNV-intersect.vcf.gz
        expect: /hot/software/pipeline/metapipeline-DNA/Nextflow/development/germline-somatic/1.0.0/test-output/test-call-sSNV/GZLUCPTA000001/GZLUCPTA000001-T001-P01-F/call_sSNV/Strelka2-2.9.10_LUAD0000034_GZLUCPTA000001-T001-P01-F_SNV-intersect.vcf.gz
        script: test/test-call-gSNP/assert_vcf.sh
      - actual: output/call-sSNV-7.0.0-rc.1/GZLUCPTA000001-T001-P01-F/MuSE-2.0.2/output/MuSE-2.0.2_LUAD0000034_GZLUCPTA000001-T001-P01-F_SNV.vcf.gz
        expect: /hot/software/pipeline/metapipeline-DNA/Nextflow/development/germline-somatic/1.0.0/test-output/test-call-sSNV/GZLUCPTA000001/GZLUCPTA000001-T001-P01-F/call_sSNV/MuSE-2.0.2_LUAD0000034_GZLUCPTA000001-T001-P01-F_SNV.vcf.gz
        script: test/test-call-gSNP/assert_vcf.sh
      - actual: output/call-sSNV-7.0.0-rc.1/GZLUCPTA000001-T001-P01-F/SomaticSniper-1.0.5.0/output/SomaticSniper-1.0.5.0_LUAD0000034_GZLUCPTA000001-T001-P01-F_SNV.vcf.gz
        expect: /hot/software/pipeline/metapipeline-DNA/Nextflow/development/germline-somatic/1.0.0/test-output/test-call-sSNV/GZLUCPTA000001/GZLUCPTA000001-T001-P01-F/call_sSNV/SomaticSniper-1.0.5.0_LUAD0000034_GZLUCPTA000001-T001-P01-F_SNV.vcf.gz
        script: test/test-call-gSNP/assert_vcf.sh
      - actual: output/call-sSNV-7.0.0-rc.1/GZLUCPTA000001-T001-P01-F/Strelka2-2.9.10/output/Strelka2-2.9.10_LUAD0000034_GZLUCPTA000001-T001-P01-F_Indel.vcf.gz
        expect: /hot/software/pipeline/metapipeline-DNA/Nextflow/development/germline-somatic/1.0.0/test-output/test-call-sSNV/GZLUCPTA000001/GZLUCPTA000001-T001-P01-F/call_sSNV/Strelka2-2.9.10_LUAD0000034_GZLUCPTA000001-T001-P01-F_Indel.vcf.gz
        script: test/test-call-gSNP/assert_vcf.sh
      - actual: output/call-sSNV-7.0.0-rc.1/GZLUCPTA000001-T001-P01-F/Strelka2-2.9.10/output/Strelka2-2.9.10_LUAD0000034_GZLUCPTA000001-T001-P01-F_SNV.vcf.gz
        expect: /hot/software/pipeline/metapipeline-DNA/Nextflow/development/germline-somatic/1.0.0/test-output/test-call-sSNV/GZLUCPTA000001/GZLUCPTA000001-T001-P01-F/call_sSNV/Strelka2-2.9.10_LUAD0000034_GZLUCPTA000001-T001-P01-F_SNV.vcf.gz
        script: test/test-call-gSNP/assert_vcf.sh
      - actual: output/call-sSNV-7.0.0-rc.1/GZLUCPTA000001-T001-P01-F/Mutect2-4.4.0.0/output/Mutect2-4.4.0.0_LUAD0000034_GZLUCPTA000001-T001-P01-F_Indel.vcf.gz
        expect: /hot/software/pipeline/metapipeline-DNA/Nextflow/development/germline-somatic/1.0.0/test-output/test-call-sSNV/GZLUCPTA000001/GZLUCPTA000001-T001-P01-F/call_sSNV/Mutect2-4.4.0.0_LUAD0000034_GZLUCPTA000001-T001-P01-F_Indel.vcf.gz
        script: test/test-call-gSNP/assert_vcf.sh
      - actual: output/call-sSNV-7.0.0-rc.1/GZLUCPTA000001-T001-P01-F/Mutect2-4.4.0.0/output/Mutect2-4.4.0.0_LUAD0000034_GZLUCPTA000001-T001-P01-F_MNV.vcf.gz
        expect: /hot/software/pipeline/metapipeline-DNA/Nextflow/development/germline-somatic/1.0.0/test-output/test-call-sSNV/GZLUCPTA000001/GZLUCPTA000001-T001-P01-F/call_sSNV/Mutect2-4.4.0.0_LUAD0000034_GZLUCPTA000001-T001-P01-F_MNV.vcf.gz
        script: test/test-call-gSNP/assert_vcf.sh
      - actual: output/call-sSNV-7.0.0-rc.1/GZLUCPTA000001-T001-P01-F/Mutect2-4.4.0.0/output/Mutect2-4.4.0.0_LUAD0000034_GZLUCPTA000001-T001-P01-F_SNV.vcf.gz
        expect: /hot/software/pipeline/metapipeline-DNA/Nextflow/development/germline-somatic/1.0.0/test-output/test-call-sSNV/GZLUCPTA000001/GZLUCPTA000001-T001-P01-F/call_sSNV/Mutect2-4.4.0.0_LUAD0000034_GZLUCPTA000001-T001-P01-F_SNV.vcf.gz
        script: test/test-call-gSNP/assert_vcf.sh

  - name: test-call-mtSNV
    message: Test call-mtSNV pipeline with one tumor normal pair
    nf_script: test/test-call-mtSNV/test.nf
    nf_config: test/test-call-mtSNV/test.config
    verbose: true
    skip: true
    asserts:
      # Disabling the tsv test as the tsv contains a timestamp so files are never equal - might require a custom comparison script
      # - actual: test/output/GZLUCPTA000001/GZLUCPTA000001-T001-P01-F/call_mtSNV/call_heteroplasmy/GZLUCPTA000001-T001-P01-F_vs_GZLUCPTA000001-N001-B01-F.tsv
      #   expect: /hot/software/pipeline/metapipeline-DNA/Nextflow/development/germline-somatic/1.0.0/test-output/test-call-mtSNV/GZLUCPTA000001/GZLUCPTA000001-T001-P01-F/call_mtSNV/call_heteroplasmy/GZLUCPTA000001-T001-P01-F_vs_GZLUCPTA000001-N001-B01-F.tsv

      - actual: output/call-mtSNV-3.0.0/GZLUCPTA000001-T001-P01-F/mitoCaller-1.0.0/output/mitoCaller2vcf-1.0.0_LUAD0000034_GZLUCPTA000001-N001-B01-F.vcf
        expect: /hot/software/pipeline/metapipeline-DNA/Nextflow/development/germline-somatic/1.0.0/test-output/test-call-mtSNV/GZLUCPTA000001/GZLUCPTA000001-T001-P01-F/call_mtSNV/convert_mitoCaller2vcf_mitoCaller/GZLUCPTA000001-T001-P01-F/GZLUCPTA000001-T001-P01-F.vcf
        script: test/test-call-gSNP/assert_vcf.sh

      - actual: output/call-mtSNV-3.0.0/GZLUCPTA000001-T001-P01-F/mitoCaller-1.0.0/output/mitoCaller2vcf-1.0.0_LUAD0000034_GZLUCPTA000001-N001-B01-F_homoplasmy.vcf
        expect: /hot/software/pipeline/metapipeline-DNA/Nextflow/development/germline-somatic/1.0.0/test-output/test-call-mtSNV/GZLUCPTA000001/GZLUCPTA000001-T001-P01-F/call_mtSNV/convert_mitoCaller2vcf_mitoCaller/GZLUCPTA000001-T001-P01-F/GZLUCPTA000001-T001-P01-F_homoplasmy.vcf
        script: test/test-call-gSNP/assert_vcf.sh


  - name: test-call-gSV
    message: Test call-gSV pipeline with one tumor normal pair
    nf_script: test/test-call-gSV/test.nf
    nf_config: test/test-call-gSV/test.config
    verbose: true
    skip: true
    asserts:
      - actual: output/call-gSV-4.0.1/GZLUCPTA000001-N001-B01-F/DELLY-1.1.3/output/DELLY-1.1.3_CNV_LUAD0000034_GZLUCPTA000001-N001-B01-F.bcf
        expect: /hot/software/pipeline/metapipeline-DNA/Nextflow/development/germline-somatic/5.0.0-rc.4/test-output/test-call-gSV/output/call-gSV-4.0.1/GZLUCPTA000001-N001-B01-F/DELLY-1.1.3/output/DELLY-1.1.3_CNV_LUAD0000034_GZLUCPTA000001-N001-B01-F.bcf
        script: test/test-call-gSV/assert_bcf.sh
      - actual: output/call-gSV-4.0.1/GZLUCPTA000001-N001-B01-F/DELLY-1.1.3/output/DELLY-1.1.3_SV_LUAD0000034_GZLUCPTA000001-N001-B01-F.bcf
        expect: /hot/software/pipeline/metapipeline-DNA/Nextflow/development/germline-somatic/5.0.0-rc.4/test-output/test-call-gSV/output/call-gSV-4.0.1/GZLUCPTA000001-N001-B01-F/DELLY-1.1.3/output/DELLY-1.1.3_SV_LUAD0000034_GZLUCPTA000001-N001-B01-F.bcf
        script: test/test-call-gSV/assert_bcf.sh
      - actual: output/call-gSV-4.0.1/GZLUCPTA000001-N001-B01-F/Manta-1.6.0/output/diploidSV.vcf.gz
        expect: /hot/software/pipeline/metapipeline-DNA/Nextflow/development/germline-somatic/5.0.0-rc.4/test-output/test-call-gSV/output/call-gSV-4.0.1/GZLUCPTA000001-N001-B01-F/Manta-1.6.0/output/diploidSV.vcf.gz
        script: test/test-call-gSNP/assert_vcf.sh
      - actual: output/call-gSV-4.0.1/GZLUCPTA000001-N001-B01-F/Manta-1.6.0/output/candidateSV.vcf.gz
        expect: /hot/software/pipeline/metapipeline-DNA/Nextflow/development/germline-somatic/5.0.0-rc.4/test-output/test-call-gSV/output/call-gSV-4.0.1/GZLUCPTA000001-N001-B01-F/Manta-1.6.0/output/candidateSV.vcf.gz
        script: test/test-call-gSNP/assert_vcf.sh
      - actual: output/call-gSV-4.0.1/GZLUCPTA000001-N001-B01-F/Manta-1.6.0/output/candidateSmallIndels.vcf.gz
        expect: /hot/software/pipeline/metapipeline-DNA/Nextflow/development/germline-somatic/5.0.0-rc.4/test-output/test-call-gSV/output/call-gSV-4.0.1/GZLUCPTA000001-N001-B01-F/Manta-1.6.0/output/candidateSmallIndels.vcf.gz
        script: test/test-call-gSNP/assert_vcf.sh


  - name: test-call-sSV
    message: Test call-sSV pipeline with one tumor normal pair
    nf_script: test/test-call-sSV/test.nf
    nf_config: test/test-call-sSV/test.config
    verbose: true
    skip: true
    asserts:
      - actual: output/call-sSV-5.0.0/CPT0053040010_realigned_recalibrated_reheadered/DELLY-1.1.3/output/DELLY-1.1.3_LUAD0000034_CPT0053040010-realigned-recalibrated-reheadered.bcf
        expect: /hot/software/pipeline/metapipeline-DNA/Nextflow/development/germline-somatic/5.0.0-rc.4/test-output/test-call-sSV/output/call-sSV-5.0.0/CPT0053040010_realigned_recalibrated_reheadered/DELLY-1.1.3/output/DELLY-1.1.3_LUAD0000034_CPT0053040010-realigned-recalibrated-reheadered.bcf
        script: test/test-call-gSV/assert_bcf.sh
      - actual: output/call-sSV-5.0.0/CPT0053040010_realigned_recalibrated_reheadered/Manta-1.6.0/output/Manta-1.6.0_LUAD0000034_CPT0053040010-realigned-recalibrated-reheadered_diploidSV.vcf.gz
        expect: /hot/software/pipeline/metapipeline-DNA/Nextflow/development/germline-somatic/5.0.0-rc.4/test-output/test-call-sSV/output/call-sSV-5.0.0/CPT0053040010_realigned_recalibrated_reheadered/Manta-1.6.0/output/Manta-1.6.0_LUAD0000034_CPT0053040010-realigned-recalibrated-reheadered_diploidSV.vcf.gz
        script: test/test-call-gSNP/assert_vcf.sh
      - actual: output/call-sSV-5.0.0/CPT0053040010_realigned_recalibrated_reheadered/Manta-1.6.0/output/Manta-1.6.0_LUAD0000034_CPT0053040010-realigned-recalibrated-reheadered_candidateSV.vcf.gz
        expect: /hot/software/pipeline/metapipeline-DNA/Nextflow/development/germline-somatic/5.0.0-rc.4/test-output/test-call-sSV/output/call-sSV-5.0.0/CPT0053040010_realigned_recalibrated_reheadered/Manta-1.6.0/output/Manta-1.6.0_LUAD0000034_CPT0053040010-realigned-recalibrated-reheadered_candidateSV.vcf.gz
        script: test/test-call-gSNP/assert_vcf.sh
      - actual: output/call-sSV-5.0.0/CPT0053040010_realigned_recalibrated_reheadered/Manta-1.6.0/output/Manta-1.6.0_LUAD0000034_CPT0053040010-realigned-recalibrated-reheadered_candidateSmallIndels.vcf.gz
        expect: /hot/software/pipeline/metapipeline-DNA/Nextflow/development/germline-somatic/5.0.0-rc.4/test-output/test-call-sSV/output/call-sSV-5.0.0/CPT0053040010_realigned_recalibrated_reheadered/Manta-1.6.0/output/Manta-1.6.0_LUAD0000034_CPT0053040010-realigned-recalibrated-reheadered_candidateSmallIndels.vcf.gz
        script: test/test-call-gSNP/assert_vcf.sh
      - actual: output/call-sSV-5.0.0/CPT0053040010_realigned_recalibrated_reheadered/Manta-1.6.0/output/Manta-1.6.0_LUAD0000034_CPT0053040010-realigned-recalibrated-reheadered_somaticSV.vcf.gz
        expect: /hot/software/pipeline/metapipeline-DNA/Nextflow/development/germline-somatic/5.0.0-rc.4/test-output/test-call-sSV/output/call-sSV-5.0.0/CPT0053040010_realigned_recalibrated_reheadered/Manta-1.6.0/output/Manta-1.6.0_LUAD0000034_CPT0053040010-realigned-recalibrated-reheadered_somaticSV.vcf.gz
        script: test/test-call-gSNP/assert_vcf.sh


  - name: test-metapipeline-DNA
    message: Test calling all pipelines with one tumor normal pair
    nf_script: module/metapipeline_DNA.nf
    nf_config: test/test-metapipeline-DNA/test.config
    params_file: test/test-metapipeline-DNA/pipeline_specific_params.json
    verbose: true
    skip: true

  - name: test-metapipeline-DNA-batch
    message: Test running the main.nf that runs the metapipeline-DNA pipeline in batch.
    nf_script: main.nf
    nf_config: test/test-metapipeline-DNA-batch/test.config
    verbose: true
    skip: true

  - name: test-metapipeline-DNA-fastq-input
    message: Test running the main.nf that runs the metapipeline-DNA pipeline in batch with fastq inputs.
    nf_script: main.nf
    nf_config: test/test-metapipeline-DNA-fastq-input/test.config
    params_file: test/test-metapipeline-DNA-fastq-input/input.yaml
    verbose: true
    skip: true
